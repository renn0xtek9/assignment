INCLUDE (InstallRequiredSystemLibraries)

ADD_CUSTOM_TARGET (
  package
  DEPENDS package_sdk package_runtime package_internal
  COMMENT "Creating all packages artifacts")

# TODO: refactor the later with a macro like: ADD_DEBIAN_PACKAGE ("sdk")
SET (CPACK_PACKAGE_NAME "sdk")
STRING (
  CONCAT
    CPACK_PACKAGE_FILE_NAME
    "${PROJECT_NAME}-"
    "${CPACK_PACKAGE_NAME}-"
    "${PROJECT_VERSION_MAJOR}-"
    "${PROJECT_VERSION_MINOR}-"
    "${PROJECT_VERSION_PATCH}-"
    "Linux")
CONFIGURE_FILE (
  ${CPACK_PACKAGE_NAME}.cmake.in
  ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake @ONLY)
ADD_CUSTOM_TARGET (
  package_sdk
  COMMAND cpack -G DEB --config
          ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake
  BYPRODUCTS ${CPACK_PACKAGE_FILE_NAME}.deb
  COMMENT "Packaging ${PROJECT_NAME} - ${CPACK_PACKAGE_NAME}"
  WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
  DEPENDS ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake
  VERBATIM)
ADD_DEPENDENCIES (package package_${CPACK_PACKAGE_NAME})

SET (CPACK_PACKAGE_NAME "runtime")
STRING (
  CONCAT
    CPACK_PACKAGE_FILE_NAME
    "${PROJECT_NAME}-"
    "${CPACK_PACKAGE_NAME}-"
    "${PROJECT_VERSION_MAJOR}-"
    "${PROJECT_VERSION_MINOR}-"
    "${PROJECT_VERSION_PATCH}-"
    "Linux")
CONFIGURE_FILE (
  ${CPACK_PACKAGE_NAME}.cmake.in
  ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake @ONLY)
ADD_CUSTOM_TARGET (
  package_${CPACK_PACKAGE_NAME}
  COMMAND cpack -G DEB --config
          ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake
  BYPRODUCTS ${CPACK_PACKAGE_FILE_NAME}.deb
  COMMENT "Packaging ${PROJECT_NAME} - ${CPACK_PACKAGE_NAME}"
  WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
  DEPENDS ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake
  VERBATIM)
ADD_DEPENDENCIES (package package_${CPACK_PACKAGE_NAME})

SET (CPACK_PACKAGE_NAME "internal")
STRING (
  CONCAT
    CPACK_PACKAGE_FILE_NAME
    "${PROJECT_NAME}-"
    "${CPACK_PACKAGE_NAME}-"
    "${PROJECT_VERSION_MAJOR}-"
    "${PROJECT_VERSION_MINOR}-"
    "${PROJECT_VERSION_PATCH}-"
    "Linux")
CONFIGURE_FILE (
  ${CPACK_PACKAGE_NAME}.cmake.in
  ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake @ONLY)
ADD_CUSTOM_TARGET (
  package_${CPACK_PACKAGE_NAME}
  COMMAND cpack -G DEB --config
          ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake
  BYPRODUCTS ${CPACK_PACKAGE_FILE_NAME}.deb
  COMMENT "Packaging ${PROJECT_NAME} - ${CPACK_PACKAGE_NAME}"
  WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
  DEPENDS ${CMAKE_BINARY_DIR}/Packaging/CPackConfig-${CPACK_PACKAGE_NAME}.cmake
  VERBATIM)
ADD_DEPENDENCIES (package package_${CPACK_PACKAGE_NAME})
